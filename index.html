<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã„šé ¤æ°£è±¡ç«™</title>
    
    <link rel="icon" type="image/png" href="./marie-icon.png">
    <link rel="apple-touch-icon" href="./marie-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./marie-icon.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
        rel="stylesheet">

    <style>
        /* ç‘ªè‰è²“ç²‰ç´…é¢¨æ ¼çš„è®Šæ•¸ */
        :root {
            --mc-pink: #FFC0CB;
            --mc-light-pink: #FEE7F0;
            --mc-cream: #FFFEF2;
            --mc-brown: #796452;
            --mc-dark: #58504A;
            --mc-blue: #90CAF9;
            --mc-cloud-border: #FEE7F0; 
            --mc-cloud-bg: #FFFFFF; 
            --mc-lace: #FF8BA6; 
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* === æ ¸å¿ƒï¼šèƒŒæ™¯è¨­å®šèˆ‡åœ–ç‰‡è¦†è“‹å±¤ (Overlay) - ç½®ä¸­èª¿æ•´ === */
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            color: var(--mc-dark);
            min-height: 100vh;
            padding-bottom: 20px;
            position: relative; 
            /* åœ–ç‰‡èƒŒæ™¯ */
            background-image: url('https://images.unsplash.com/photo-1612287525793-0d8899242fd7?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDBfQ%3D%3D');
            background-size: cover; 
            background-attachment: fixed; 
            background-position: center center;
            background-color: var(--mc-light-pink); 
        }
        
        /* åŠé€æ˜ç™½è‰²è¦†è“‹å±¤ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.6); 
            z-index: -1; 
        }

        /* é ‚éƒ¨ç‹€æ…‹åˆ— */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.5); 
            backdrop-filter: blur(5px); 
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        /* æ–°å¢ï¼šé¡¯ç¤ºå›ºå®šåŸå¸‚åç¨±çš„æ¨£å¼ */
        .city-display {
             font-weight: 900;
             font-size: 1.1rem;
             color: var(--mc-dark);
             padding: 8px 15px;
             background: var(--mc-cream);
             border-radius: 25px;
             border: 3px solid var(--mc-pink);
             box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.15);
        }

        /* ä¿®æ”¹ï¼šæ”¾å¤§å³ä¸Šè§’æ—¥æœŸæ–‡å­— (update-pill) */
        .update-pill {
            font-size: 1rem; 
            color: var(--mc-dark); 
            background: var(--mc-light-pink);
            padding: 6px 12px; 
            border-radius: 15px; 
            font-weight: bold;
        }

        .container {
            padding: 20px;
            max-width: 900px; 
            margin: 0 auto; 
        }
        
        /* ---------------------------------------------------- */
        /* === ä¸»å¡ç‰‡èˆ‡ç¨å¾Œé å ±å¡ç‰‡å·¦å³å°é½Šã€é«˜åº¦ç›¸ç­‰ (CSS Grid) === */
        /* ---------------------------------------------------- */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr; 
            grid-template-rows: auto;
            gap: 15px; 
            align-items: stretch; 
            margin-bottom: 25px;
        }
        
        .hero-card-wrapper {
            grid-column: 1 / 2;
        }
        
        .hourly-forecast-wrapper {
            grid-column: 2 / 3;
            display: flex;
            flex-direction: column; 
            gap: 15px; 
        }
        
        .hourly-forecast-wrapper .hourly-card {
            flex-grow: 1; 
            width: 100%;
            margin-top: 0;
        }
        
        /* æ‰‹æ©Ÿç‰ˆé©æ‡‰ */
        @media (max-width: 650px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
            }
            .hero-card-wrapper {
                grid-column: 1 / 2;
                grid-row: 1 / 2;
            }
            .hourly-forecast-wrapper {
                grid-column: 1 / 2;
                grid-row: 2 / 3;
                flex-grow: unset; 
            }
            .hourly-forecast-wrapper .hourly-card {
                flex-grow: unset; 
            }
        }
        /* === çµæŸï¼šç‰ˆé¢ä¿®æ”¹ === */


        /* === ä»Šæ—¥ç„¦é»å¡ç‰‡ (å·¦å´) === */
        .hero-card {
            background: var(--mc-cream); 
            border-radius: 35px;
            padding: 30px 25px;
            /* å…§å®¹æ•´é«”ç½®ä¸­ */
            text-align: center; 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border: 4px solid var(--mc-pink); 
            position: relative;
            height: 100%; 
        }

        /* å°è©±æ°£æ³¡ */
        .hero-period {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--mc-pink); 
            color: white;
            padding: 5px 20px 5px 20px; 
            border-radius: 20px;
            font-weight: bold;
            border: 3px solid var(--mc-dark); 
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
            display: flex; 
            align-items: center;
            justify-content: center; /* ç¢ºä¿å…§å®¹æ°´å¹³ç½®ä¸­ */
            white-space: nowrap;
        }
        
        /* **æ­¤è™•ç§»é™¤ .hero-period::before å€å¡Šï¼Œå³ç§»é™¤ä¸»å¡ç‰‡ ICON** */

        .hero-temp-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .hero-weather-icon {
            font-size: 5rem;
            filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.1));
            animation: bounce 3s infinite; 
            margin-right: 0; 
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hero-temp {
            font-size: 4.5rem;
            font-weight: 900;
            color: var(--mc-brown);
            line-height: 1;
        }

        .hero-desc {
            font-size: 1.2rem; 
            color: #8A7B70;
            margin-bottom: 20px;
            font-weight: bold;
        }

        /* å»ºè­°å€ */
        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #E0D8C0;
            margin-bottom: 0;
        }

        .advice-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.7); 
            padding: 10px;
            border-radius: 20px;
            box-shadow: 1px 1px 0 rgba(0, 0, 0, 0.1);
        }

        .advice-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .advice-text {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--mc-brown);
            margin: 5px 0;
            line-height: 1.2;
        }
        
        /* ç¨å¾Œé å ± (Hourly) æ¨£å¼ */
        .hourly-card {
            background: var(--mc-cream);
            border-radius: 20px;
            padding: 15px 10px;
            text-align: center;
            border: 2px solid var(--mc-pink);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* ç¨å¾Œé å ±çš„é™é›¨æ©Ÿç‡æ¨£å¼ */
        .rain-prob-text {
            font-size: 0.8rem;
            color: var(--mc-blue);
            font-weight: 700;
            margin-top: 5px;
        }


        .hourly-time {
            font-weight: 700;
            color: var(--mc-dark);
            margin-bottom: 5px;
            font-size: 1rem; 
        }

        .hourly-icon {
            font-size: 2.5rem;
        }

        .hourly-temp {
            font-size: 0.9rem;
            color: var(--mc-brown);
            font-weight: 700;
            margin-top: 5px;
        }


        /* Loading & Error */
        .loading-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--mc-pink);
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            z-index: 999;
        }
        
        #loading img {
            width: 80px; 
            animation: bounce 2s infinite;
            
            display: block; 
            margin: 0 auto; 

            border: 0;
            box-shadow: none;
            border-radius: 0;
        }

        #error-message {
            background: #FEE7F0; color: #C62828; 
            border: 3px dashed #FF8A80; 
            padding: 15px; margin: 20px auto; max-width: 500px;
            border-radius: 15px; text-align: center; font-weight: bold;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1); display: none; 
        }
    </style>
</head>

<body>
    <div id="loading" class="loading-screen">
        <img src="./marie-icon.png" alt="ç‘ªè‰è²“åœ–ç¤ºï¼Œæ­£åœ¨è¼‰å…¥ä¸­">
        <p style="color: white; font-weight: bold; margin-top: 20px;">æ­£åœ¨å‘¼å–šç‘ªè‰è²“å•å¤©æ°£...</p>
    </div>
    
    <div id="error-message"></div>

    <div class="status-bar">
        <div id="cityDisplay" class="city-display">é«˜é›„å¸‚</div>
        
        <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        
        <div class="main-grid">
            
            <div class="hero-card-wrapper">
                <div id="heroCard">
                    </div>
            </div>

            <div id="hourlyForecastsWrapper" class="hourly-forecast-wrapper">
                </div>
            
        </div>
    </div>

    <script>
        const BASE_API_URL = "https://weather-final-etenia.zeabur.app/api/weather/";
        const CITIES = {
            'Kaohsiung': 'é«˜é›„å¸‚', 
            'Taipei': 'è‡ºåŒ—å¸‚',
            'Taichung': 'è‡ºä¸­å¸‚',
            'Tainan': 'è‡ºå—å¸‚',
            'New_Taipei': 'æ–°åŒ—å¸‚', 
            'Taoyuan': 'æ¡ƒåœ’å¸‚',
            'Keelung': 'åŸºéš†å¸‚',    
            'Hsinchu': 'æ–°ç«¹å¸‚',    
            'Hsinchu_County': 'æ–°ç«¹ç¸£', 
            'Miaoli': 'è‹—æ —ç¸£',
            'Changhua': 'å½°åŒ–ç¸£',
            'Nantou': 'å—æŠ•ç¸£',
            'Yunlin': 'é›²æ—ç¸£',
            'Chiayi': 'å˜‰ç¾©å¸‚',      
            'Chiayi_County': 'å˜‰ç¾©ç¸£', 
            'Pingtung': 'å±æ±ç¸£',
            'Yilan': 'å®œè˜­ç¸£',
            'Hualien': 'èŠ±è“®ç¸£',
            'Taitung': 'è‡ºæ±ç¸£',
            'Penghu': 'æ¾æ¹–ç¸£',
            'Kinmen': 'é‡‘é–€ç¸£',
            'Matsu': 'é€£æ±Ÿç¸£'      
        };
        // å›ºå®šç‚º Kaohsiung
        let currentCityKey = 'Kaohsiung'; 

        function getCityName(key) { return CITIES[key] || 'æœªçŸ¥åœ°é»'; }
        function getWeatherIcon(weather) {
            if (!weather) return "ğŸŒ¤ï¸";
            if (weather.includes("æ™´")) return "â˜€ï¸";
            if (weather.includes("å¤šé›²")) return "â›…";
            if (weather.includes("é™°")) return "â˜ï¸";
            if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
            if (weather.includes("é›·")) return "â›ˆï¸";
            return "ğŸŒ¤ï¸";
        }
        function getAdvice(rainProb, maxTemp) {
            let rainIcon = (parseInt(rainProb) > 30) ? "â˜‚ï¸" : "ğŸŒ‚";
            let rainText = (parseInt(rainProb) > 30) ? "è¨˜å¾—å¸¶å‚˜ï¼" : "ä¸ç”¨å¸¶å‚˜";
            let clothIcon = "ğŸ‘•";
            let clothText = "èˆ’é©ç©¿æ­";
            if (parseInt(maxTemp) >= 28) { clothIcon = "ğŸ½"; clothText = "çŸ­è¢–å‡ºç™¼"; } 
            else if (parseInt(maxTemp) <= 20) { clothIcon = "ğŸ§¥"; clothText = "åŠ ä»¶å¤–å¥—"; }
            return { rainIcon, rainText, clothIcon, clothText };
        }
        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "æ—©æ™¨";
            if (hour >= 11 && hour < 14) return "ä¸­åˆ";
            if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
            if (hour >= 18 && hour < 23) return "æ™šä¸Š";
            return "æ·±å¤œ";
        }
        
        function displayError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.innerHTML = `âŒ **ç·Šæ€¥é€šçŸ¥ï¼** ${message} <br>è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚`;
            errorElement.style.display = 'block';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
        }
        function hideError() {
             document.getElementById('error-message').style.display = 'none';
        }
        
        function getHourlyForecasts(forecasts) {
            return forecasts.slice(1, 7); 
        }

        function renderWeather(data) {
            hideError(); 
            const forecasts = data.forecasts;
            const current = forecasts[0]; 
            const now = new Date();
            const nextForecasts = getHourlyForecasts(forecasts);
            
            const advice = getAdvice(current.rain, current.maxTemp);
            const period = getTimePeriod(current.startTime); 
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

            // æ›´æ–°é ‚éƒ¨åŸå¸‚é¡¯ç¤º
            document.getElementById('cityDisplay').textContent = getCityName(currentCityKey);


            document.getElementById('heroCard').innerHTML = `
                        <div class="hero-card">
                            <div class="hero-period">${period} å¤©æ°£</div>
                            <div class="hero-temp-container">
                                <div class="hero-weather-icon">${getWeatherIcon(current.weather)}</div>
                                <div class="hero-temp">${avgTemp}Â°</div>
                            </div>
                            <div class="hero-desc">ä»Šæ—¥æº«åº¦ï¼š${current.minTemp} ~ ${current.maxTemp} (${current.weather})</div>
                            
                            <div class="advice-grid">
                                <div class="advice-item">
                                    <div class="advice-icon">${advice.rainIcon}</div>
                                    <div class="advice-text">${advice.rainText}</div>
                                    <div style="font-size:0.7rem; color:#999">é™é›¨ç‡ ${current.rain}</div>
                                </div>
                                <div class="advice-item">
                                    <div class="advice-icon">${advice.clothIcon}</div>
                                    <div class="advice-text">${advice.clothText}</div>
                                    <div style="font-size:0.7rem; color:#999">æœ€é«˜æº« ${current.maxTemp}</div>
                                </div>
                            </div>
                        </div>
                    `;

            const hourlyContainer = document.getElementById('hourlyForecastsWrapper');
            const periodsShown = new Set([period]); 
            const uniqueHourlyForecasts = [];

            for (const f of nextForecasts) {
                const timePeriodName = getTimePeriod(f.startTime);
                
                if (!periodsShown.has(timePeriodName)) {
                    uniqueHourlyForecasts.push({
                        timePeriodName: timePeriodName, 
                        minTemp: f.minTemp,
                        maxTemp: f.maxTemp,
                        weather: f.weather,
                        rain: f.rain 
                    });
                    periodsShown.add(timePeriodName);
                }
                
                if (uniqueHourlyForecasts.length >= 3) {
                    break; 
                }
            }
            
            
            if (uniqueHourlyForecasts.length === 0) {
                 hourlyContainer.innerHTML = '<div class="hourly-card" style="height:100%"><p style="text-align:center; color:#8A7B70; ">**ä»Šå¤©æ²’æœ‰æ›´å¤šçš„åˆ†æ™‚é å ±äº†ã€‚**</p></div>';
            } else {
                 hourlyContainer.innerHTML = uniqueHourlyForecasts.map(f => {
                    return `
                        <div class="hourly-card">
                            <div class="hourly-time">${f.timePeriodName}</div> 
                            <div class="hourly-icon">${getWeatherIcon(f.weather)}</div>
                            <div class="hourly-temp"> ${f.minTemp} ~ ${f.maxTemp}</div>
                            <div class="rain-prob-text">â˜” ${f.rain}</div>
                        </div>
                    `;
                 }).join('');
            }

            const month = now.getMonth() + 1;
            const date = now.getDate();
            const dayIndex = now.getDay();
            const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
            document.getElementById('updateTime').textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
        }
        
        async function fetchWeather() {
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            hideError(); 

            const final_API_URL = BASE_API_URL + currentCityKey; 

            try {
                const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
                const fetchPromise = fetch(final_API_URL).then(res => {
                    if (!res.ok) {
                        throw new Error(`ç„¡æ³•é€£æ¥åˆ° ${getCityName(currentCityKey)} çš„æ°£è±¡è³‡æ–™ã€‚`);
                    }
                    return res.json();
                });

                const [_, json] = await Promise.all([delayPromise, fetchPromise]);

                if (json.success && json.data.forecasts && json.data.forecasts.length > 0) {
                    renderWeather(json.data);

                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } else {
                    throw new Error("API å›æ‡‰æ ¼å¼éŒ¯èª¤æˆ–é å ±è³‡æ–™ç‚ºç©ºã€‚");
                }
            } catch (e) {
                console.error(e);
                displayError(`ç„¡æ³•è®€å– **${getCityName(currentCityKey)}** çš„è³‡æ–™ã€‚ (${e.message})`);
                document.getElementById('loading').style.display = 'none';
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchWeather();    
        });
    </script>
</body>

</html>